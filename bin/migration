#!/usr/bin/env ruby

def run(cmd)
  puts cmd
  result = `#{cmd}`
  puts result
  result
end

is_zeus = File.exists? '.zeus.sock'

output = run "#{is_zeus ? 'zeus' : 'rails'} generate migration #{ARGV[0]}"

migration_path = output.match(%r|db/migrate/.*\.rb|)[0]

if migration_path
  run "mvim #{migration_path}"
  run "#{'zeus' if is_zeus} rake db:migrate db:test:prepare"
end
