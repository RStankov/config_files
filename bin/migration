#!/usr/bin/env ruby

def run(cmd)
  puts cmd
  result = `#{cmd}`
  puts result
  result
end

output = run "rails generate migration #{ARGV[0]}"

migration_path = output.match(%r|db/migrate/.*\.rb|)[0]

if migration_path
  run "mvim #{migration_path}"
  run "bundle exec rake db:migrate db:test:prepare"
end
